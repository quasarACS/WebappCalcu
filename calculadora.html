<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Quasar</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fuentes personalizadas: Roboto es la fuente de Material Design por excelencia */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #212121; /* Negro casi puro */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box; /* Asegura que padding no aumente el tamaño */
        }
        .calculator-container {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Más espacio entre secciones */
            width: 100%;
            max-width: 400px; /* Ligeramente más ancho */
            background-color: #333333; /* Gris oscuro para la superficie */
            border-radius: 16px; /* Bordes redondeados suaves */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4), 0 12px 40px rgba(0, 0, 0, 0.2); /* Sombra Material más profunda */
            padding: 20px;
            /* Establecer una altura mínima para evitar saltos bruscos.
               La altura final se ajustará al contenido, pero esta es una base. */
            min-height: 550px; 
        }
        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 12px; /* Espaciado entre botones de modo */
            margin-bottom: 0;
        }
        .mode-button {
            padding: 10px 24px;
            font-size: 1.0rem;
            font-weight: 500;
            border: none;
            border-radius: 20px; /* Bordes más redondeados (pill shape) */
            cursor: pointer;
            outline: none;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
            background-color: #424242; /* Gris oscuro para inactivos */
            color: #E0E0E0; /* Blanco suave para texto */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Sombra ligera */
        }
        .mode-button.active {
            background-color: #1565C0; /* Azul fuerte para el activo (Blue 800) */
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Sombra más pronunciada al estar activo */
            transform: translateY(-1px); /* Ligero efecto de elevación */
        }
        .mode-button:hover:not(.active) {
            background-color: #616161; /* Gris más claro al pasar el ratón */
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
        }
        .mode-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15); /* Sombra mínima al presionar */
        }

        /* La sección .business-mode-options se ha integrado al .output,
           por lo que esta clase ya no será usada como contenedor principal. */
        /* .business-mode-options {
            background-color: #424242;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        } */

        .rate-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        .rate-input-group label {
            color: #BDBDBD; /* Gris claro */
            font-size: 0.85rem; /* Más pequeño para que quepa */
            min-width: 80px; /* Ancho fijo para la etiqueta */
            font-weight: 500;
        }
        .rate-input-group input.rate-input { /* Usar una clase específica para el input */
            flex-grow: 1;
            padding: 8px 12px; /* Más compacto */
            border-radius: 8px;
            border: 1px solid #616161; /* Gris oscuro para el borde */
            background-color: #212121; /* Fondo negro */
            color: white; /* Texto blanco */
            font-size: 1.0rem; /* Más pequeño */
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .rate-input-group input.rate-input:focus {
            border-color: #2196F3; /* Azul primario al enfocar */
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.3); /* Sombra de foco azul */
        }
        /* El botón de convertir ya no es necesario, su lógica está en JS */
        /* .convert-button { ... } */

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 0;
            background-color: transparent;
            border-radius: 0;
            box-shadow: none;
            width: 100%;
            touch-action: manipulation;
        }
        .output {
            grid-column: 1 / -1;
            background-color: #212121; /* Negro puro para el display */
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: space-around; /* Distribuye el espacio vertical */
            padding: 16px 20px 8px; /* Ajuste de padding para el footer */
            word-wrap: break-word;
            word-break: break-all;
            border-radius: 12px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            min-height: 150px; /* Altura mínima para acomodar todo */
            position: relative; /* Para posicionar el texto del footer */
            transition: all 0.2s ease-in-out; /* Transición suave para cambios */
        }
        .output .previous-operand {
            color: rgba(255, 255, 255, 0.6); /* Blanco semitransparente para texto secundario */
            font-size: 1.1rem;
            min-height: 1.1em;
            flex-shrink: 0; /* Evita que se encoja */
        }
        .output .current-operand {
            color: white; /* Blanco puro para el número principal */
            font-size: 3.2rem;
            font-weight: 400;
            line-height: 1.2;
            margin-top: auto; /* Empuja hacia abajo */
            flex-grow: 1; /* Permite que ocupe espacio disponible */
            display: flex;
            align-items: flex-end; /* Alinea el texto al final */
        }
        /* Contenedor para la entrada de conversión y el resultado en Bs. */
        .output .conversion-display {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px; /* Espacio antes de esta sección */
            align-items: flex-end;
            flex-shrink: 0; /* Evita que se encoja */
            padding-bottom: 5px; /* Pequeño padding para no tocar el footer */
        }
        .output .converted-operand {
            color: #8BC34A; /* Light Green 500 para el resultado en Bolívares */
            font-size: 1.3rem;
            min-height: 1.2em;
            font-weight: 500;
            text-align: right; /* Asegura que el texto se alinee a la derecha */
            width: 100%;
        }
        .output .footer-text {
            position: absolute;
            bottom: 8px; /* Pequeño margen desde abajo */
            left: 15px; /* Pequeño margen desde la izquierda */
            color: rgba(255, 255, 255, 0.3); /* Muy tenue */
            font-size: 0.75rem; /* Muy pequeño */
            font-weight: 300; /* Ligero */
            pointer-events: none; /* No interactivo */
        }
        .hidden {
            display: none !important; /* Tailwind's hidden class */
        }

        /* Estilos para los botones numéricos y de operación */
        .calculator-button {
            background-color: #616161; /* Gris oscuro para el fondo de botones numéricos */
            color: white; /* Texto blanco */
            padding: 20px 0;
            font-size: 1.7rem;
            font-weight: 400;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            outline: none;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Sombra ligera */
        }
        .calculator-button:hover {
            background-color: #757575; /* Gris un poco más claro al pasar el ratón */
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }
        .calculator-button:active {
            background-color: #9E9E9E; /* Gris más claro al presionar */
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        .operator {
            background-color: #2196F3; /* Azul para operadores */
            color: white;
        }
        .operator:hover {
            background-color: #42A5F5; /* Azul más claro */
        }
        .operator:active {
            background-color: #1976D2; /* Azul más oscuro */
        }
        .span-two {
            grid-column: span 2;
            background-color: #2196F3; /* Azul para el botón de igual */
            color: white;
        }
        .span-two:hover {
            background-color: #42A5F5; /* Azul más claro */
        }
        .span-two:active {
            background-color: #1976D2; /* Azul más oscuro */
        }
        .clear-all, .delete-btn {
            background-color: #F44336; /* Rojo para AC y DEL */
            color: white;
        }
        .clear-all:hover, .delete-btn:hover {
            background-color: #E57373; /* Rojo más claro */
        }
        .clear-all:active, .delete-btn:active {
            background-color: #D32F2F; /* Rojo más oscuro */
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="mode-selection">
            <button id="normalModeBtn" class="mode-button active rounded-xl">Modo Normal</button>
            <button id="businessModeBtn" class="mode-button rounded-xl">Calculador USD a BS</button>
        </div>

        <div class="calculator-grid">
            <div class="output">
                <div data-previous-operand class="previous-operand"></div>
                <div data-current-operand class="current-operand"></div>
                <!-- Sección para el modo de negocio (inicialmente oculta) -->
                <div class="conversion-display hidden" id="conversionDisplayArea">
                    <div class="rate-input-group">
                        <label for="conversionRateInput">Tasa de Conversión:</label>
                        <input type="number" id="conversionRateInput" placeholder="0.00" inputmode="decimal" class="rate-input">
                    </div>
                    <div data-converted-operand class="converted-operand"></div>
                </div>
                <div class="footer-text">Hecho con ❤ por Erick</div>
            </div>
            <button data-all-clear class="calculator-button span-two clear-all rounded-xl">AC</button>
            <button data-delete class="calculator-button delete-btn rounded-xl">DEL</button>
            <button data-operator class="calculator-button operator rounded-xl">÷</button>
            <button data-number class="calculator-button rounded-xl">1</button>
            <button data-number class="calculator-button rounded-xl">2</button>
            <button data-number class="calculator-button rounded-xl">3</button>
            <button data-operator class="calculator-button operator rounded-xl">*</button>
            <button data-number class="calculator-button rounded-xl">4</button>
            <button data-number class="calculator-button rounded-xl">5</button>
            <button data-number class="calculator-button rounded-xl">6</button>
            <button data-operator class="calculator-button operator rounded-xl">+</button>
            <button data-number class="calculator-button rounded-xl">7</button>
            <button data-number class="calculator-button rounded-xl">8</button>
            <button data-number class="calculator-button rounded-xl">9</button>
            <button data-operator class="calculator-button operator rounded-xl">-</button>
            <button data-number class="calculator-button rounded-xl">.</button>
            <button data-number class="calculator-button rounded-xl">0</button>
            <button data-equals class="calculator-button span-two rounded-xl">=</button>
        </div>
    </div>

    <script>
        class Calculator {
            constructor(previousOperandTextElement, currentOperandTextElement, convertedOperandTextElement, conversionDisplayArea) {
                this.previousOperandTextElement = previousOperandTextElement;
                this.currentOperandTextElement = currentOperandTextElement;
                this.convertedOperandTextElement = convertedOperandTextElement;
                this.conversionDisplayArea = conversionDisplayArea; // Nueva referencia al div de conversión
                this.currentMode = 'normal';
                this.conversionRate = 0; // Tasa de conversión única
                this.clear();
            }

            clear() {
                this.currentOperand = '';
                this.previousOperand = '';
                this.operation = undefined;
                // No se limpia convertedOperand aquí, se recalcula en updateDisplay
                this.updateDisplay();
            }

            delete() {
                this.currentOperand = this.currentOperand.toString().slice(0, -1);
                this.updateDisplay(); // Se recalcula en updateDisplay
            }

            appendNumber(number) {
                // Previene múltiples puntos decimales
                if (number === '.' && this.currentOperand.includes('.')) return;
                // Si el operando actual es un resultado de un cálculo o un error, y se escribe un número, se reinicia.
                // Excepto si es un punto decimal, para permitir añadir decimales a un 0 inicial.
                if (this.currentOperand === 'Error' || (this.currentOperand === '' && number !== '.' && this.operation === undefined && this.previousOperand === '')) {
                     this.currentOperand = number.toString();
                } else if (this.currentOperand === '0' && number !== '.') { // Evita 00, 01, etc.
                    this.currentOperand = number.toString();
                }
                else {
                    this.currentOperand = this.currentOperand.toString() + number.toString();
                }
               
                this.updateDisplay();
            }

            chooseOperation(operation) {
                if (this.currentOperand === '') return;
                if (this.previousOperand !== '') {
                    this.compute();
                }
                this.operation = operation;
                this.previousOperand = this.currentOperand;
                this.currentOperand = '';
                this.updateDisplay();
            }

            compute() {
                let computation;
                const prev = parseFloat(this.previousOperand);
                const current = parseFloat(this.currentOperand);

                if (isNaN(prev) || isNaN(current)) {
                    // Si solo hay un número actual y se presiona '=', solo muestra ese número
                    if (!isNaN(current) && this.operation === undefined) {
                        this.currentOperand = current;
                        this.previousOperand = '';
                        this.operation = undefined;
                        this.updateDisplay();
                        return;
                    }
                    return; // No hay suficientes números para computar
                }

                switch (this.operation) {
                    case '+':
                        computation = prev + current;
                        break;
                    case '-':
                        computation = prev - current;
                        break;
                    case '*':
                        computation = prev * current;
                        break;
                    case '÷':
                        if (current === 0) {
                            computation = 'Error'; // Evita división por cero
                        } else {
                            computation = prev / current;
                        }
                        break;
                    default:
                        return; // No hay operación seleccionada
                }
                
                this.currentOperand = computation;
                this.operation = undefined;
                this.previousOperand = '';
                this.updateDisplay();
            }

            // Método para obtener el número formateado para la pantalla principal
            getDisplayNumber(number) {
                const stringNumber = number.toString();
                const integerDigits = parseFloat(stringNumber.split('.')[0]);
                const decimalDigits = stringNumber.split('.')[1];
                let integerDisplay;
                if (isNaN(integerDigits)) {
                    integerDisplay = '';
                } else {
                    integerDisplay = new Intl.NumberFormat('en-US', {
                        maximumFractionDigits: 0
                    }).format(integerDigits);
                }
                if (decimalDigits != null && decimalDigits !== '') {
                    return `${integerDisplay}.${decimalDigits}`;
                } else {
                    return integerDisplay;
                }
            }

            // Método para obtener el número formateado en Bolívares
            getBsDisplayNumber(number) {
                if (isNaN(number) || typeof number !== 'number') return '';
                return new Intl.NumberFormat('es-VE', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(number);
            }

            updateDisplay() {
                this.currentOperandTextElement.innerText =
                    this.getDisplayNumber(this.currentOperand);
                if (this.operation != null) {
                    this.previousOperandTextElement.innerText =
                        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
                } else {
                    this.previousOperandTextElement.innerText = '';
                }

                // Lógica de visualización para el modo de negocio
                if (this.currentMode === 'business') {
                    this.conversionDisplayArea.classList.remove('hidden'); // Muestra el área de conversión
                    const currentVal = parseFloat(this.currentOperand);
                    if (!isNaN(currentVal) && !isNaN(this.conversionRate) && this.conversionRate > 0) {
                        this.convertedOperand = currentVal * this.conversionRate;
                        this.convertedOperandTextElement.innerText = `Bs: ${this.getBsDisplayNumber(this.convertedOperand)}`;
                    } else {
                        this.convertedOperandTextElement.innerText = 'Bs: ---'; // Muestra un guion si no hay valor
                    }
                } else {
                    this.conversionDisplayArea.classList.add('hidden'); // Oculta el área de conversión
                    this.convertedOperandTextElement.innerText = ''; // Limpia el texto de conversión
                }
            }

            setMode(mode) {
                this.currentMode = mode;
                // Limpiar la calculadora al cambiar de modo
                this.clear();
                this.updateDisplay(); // Forzar actualización de la pantalla para mostrar/ocultar el conversor
                
                // Actualizar clases de los botones de modo
                document.getElementById('normalModeBtn').classList.toggle('active', mode === 'normal');
                document.getElementById('businessModeBtn').classList.toggle('active', mode === 'business');
            }
        }

        // Obtener referencias a los elementos HTML
        const numberButtons = document.querySelectorAll('[data-number]');
        const operatorButtons = document.querySelectorAll('[data-operator]');
        const equalsButton = document.querySelector('[data-equals]');
        const deleteButton = document.querySelector('[data-delete]');
        const allClearButton = document.querySelector('[data-all-clear]');
        const previousOperandTextElement = document.querySelector('[data-previous-operand]');
        const currentOperandTextElement = document.querySelector('[data-current-operand]');
        const convertedOperandTextElement = document.querySelector('[data-converted-operand]');
        const conversionDisplayArea = document.getElementById('conversionDisplayArea'); // Obtener el div completo

        // Botones y campos de modo
        const normalModeBtn = document.getElementById('normalModeBtn');
        const businessModeBtn = document.getElementById('businessModeBtn');
        const conversionRateInput = document.getElementById('conversionRateInput'); // Campo de tasa única
        // const applyConversionBtn = document.getElementById('applyConversionBtn'); // Este botón ya no es necesario

        // Crear una instancia de la calculadora
        const calculator = new Calculator(previousOperandTextElement, currentOperandTextElement, convertedOperandTextElement, conversionDisplayArea);

        // AñadirEventListeners a los botones numéricos
        numberButtons.forEach(button => {
            button.addEventListener('click', () => {
                calculator.appendNumber(button.innerText);
            });
        });

        // AñadirEventListeners a los botones de operador
        operatorButtons.forEach(button => {
            button.addEventListener('click', () => {
                calculator.chooseOperation(button.innerText);
            });
        });

        // AñadirEventListener al botón de igual
        equalsButton.addEventListener('click', button => {
            calculator.compute();
        });

        // AñadirEventListener al botón de limpiar todo (AC)
        allClearButton.addEventListener('click', button => {
            calculator.clear();
        });

        // AñadirEventListener al botón de borrar (DEL)
        deleteButton.addEventListener('click', button => {
            calculator.delete();
        });

        // EventListeners para los botones de modo
        normalModeBtn.addEventListener('click', () => calculator.setMode('normal'));
        businessModeBtn.addEventListener('click', () => calculator.setMode('business'));

        // EventListener para el input de tasa de conversión
        conversionRateInput.addEventListener('input', (e) => {
            calculator.conversionRate = parseFloat(e.target.value) || 0;
            calculator.updateDisplay(); // Actualiza la conversión en tiempo real al cambiar la tasa
        });

        // EventListener para el input de tasa de conversión para manejar "Enter"
        conversionRateInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Evitar salto de línea en el input
                calculator.conversionRate = parseFloat(e.target.value) || 0;
                calculator.updateDisplay();
                // Opcional: enfocar de nuevo el campo principal o un botón
                currentOperandTextElement.focus(); 
            }
        });

        // Manejo de entrada de teclado para la calculadora normal
        document.addEventListener('keydown', e => {
            // Permitir que el input de la tasa de conversión maneje sus propias entradas
            if (e.target.id === 'conversionRateInput') return;

            // Números y punto
            if ((e.key >= '0' && e.key <= '9') || e.key === '.') {
                calculator.appendNumber(e.key);
            }
            // Operadores
            if (e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/') {
                calculator.chooseOperation(e.key === '/' ? '÷' : e.key);
            }
            // Enter para igual
            if (e.key === 'Enter' || e.key === '=') {
                e.preventDefault(); // Previene el comportamiento por defecto de Enter (ej. clic en el último botón enfocado)
                calculator.compute();
            }
            // Backspace para borrar
            if (e.key === 'Backspace') {
                calculator.delete();
            }
            // Escape para limpiar todo
            if (e.key === 'Escape') {
                calculator.clear();
            }
        });

        // Inicializar el modo al cargar la página
        window.onload = () => {
            calculator.setMode('normal');
        };
    </script>
</body>
</html>
